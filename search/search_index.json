{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the documentation of Ge\u00fcbt-Validate","text":"<p>This is the input validation module of NRW-GE\u00dcBT.</p> <p>User uploaded metadata and assemblies are checked for conformity in the following steps:</p> <ul> <li>Metadata are checked to conform to a predefined schemata of obigatory and optionnal metadata.   As wel as accepted formats and values.</li> <li>User provided checksum of the assemblies is compared to a recalculated checksum to ensure   fasta integrity</li> <li>A set of assembly metrics is calculated based on the provided assemblies to   ensure that the data fulfill the minimal quality requirements</li> </ul> <p>While this module can be used on its own, it is recommended to use the Ge\u00fcbt-core application instead.</p>"},{"location":"contributing/","title":"Contribution guide","text":"<p>Maintaining a repository is a lot of work and it is only possible with the input for its users. That's why we love to get your feedback and continuously improve! We want to contibuting to this project as easy and transparent as possible. That's why we ask all contributions to go through a GitHub workflow.</p>"},{"location":"contributing/#ask-a-question-report-a-bug-or-suggest-new-features","title":"Ask a question, report a bug, or suggest new features","text":"<p>Wether you wish to report a bug, discuss the current state of the code, how to use it, or propose new features, the GitHub repository is the place to start.</p> <p>Go to 'Issues' in the repository's menu and use the search bar to look for your issue/question, maybe the discussion already exists! if you don't find what you are looking for, use the green button 'New Issue' and select the correct template (Question, Bug report or New feature).</p>"},{"location":"contributing/#bug-reports","title":"Bug reports","text":"<p>Solving Bugs is not always easy and usually requires to be able to precisely understand what happened. Try to include the following in your report, so we can solve the problems quickly:</p> <ul> <li>A quick summary and/or background</li> <li>The software versions</li> <li>A precise description of the problem</li> <li>Join input data that reproduce the problem if possible</li> <li>Attach relevant log files to the issue</li> </ul>"},{"location":"contributing/#improving-the-documentation","title":"Improving the documentation","text":"<p>Writting a documentation is a big task and we are gratefull for any help to expand and improve it.</p> <p>If you find a specific section of the documentaiton unclear, or would like to see it in other languages, we would love to hear about it, or if you feel like it, try suggesting modifications.</p>"},{"location":"contributing/#writting-tests","title":"Writting tests","text":"<p>The critical parts of the workflow are currently verified by unit tests. These could always be improved and/or expanded. If you like to write tests, check the <code>.tests/unit</code> folder and suggest changes.</p>"},{"location":"contributing/#submitting-changes","title":"Submitting changes","text":"<p>All changes in the repository are made through pull requests.</p>"},{"location":"contributing/#github-worflow","title":"Github worflow","text":"<p>To submitt a pull request:</p> <ul> <li>Fork the repository and create your branch from <code>main</code></li> <li>Make your changes to the code base/documentation/tests</li> <li>If you have added code that shoul dbe testes, add tests</li> <li>If you have changed the parameters or formating of the inputs, update the documentation</li> <li>Ensure that your code passes the tests and lints, this will be automatically   tested when you submit your pull request</li> <li>Issue your pull request and wait for a maintainer to review the changes</li> </ul> <p>Please provide precise and sufficient information on the changes you performed when you submit your pull request.</p>"},{"location":"contributing/#tests","title":"Tests","text":"<p>It is a good idea to locally run tests before submitting your pull request.</p>"},{"location":"contributing/#unit-tests","title":"Unit tests","text":"<p>We use pytest for running unit tests. Make sure your current environment supports a recent version of python (3.9 or 3.10).</p> <pre><code>python -m pip install --upgrade pip\npip install pytest\npip install -r .tests/unit/requirements.txt  # Install tests dependencies\npytest .tests/unit\n</code></pre>"},{"location":"contributing/#integration-test","title":"Integration test","text":"<p>It is always a good idea to verify that the workflow runs properly as a whole. For this activate a conda enviroment with a recent version of snakemake (see the documentation) and run the following test:</p> <pre><code>snakemake --cores 1 --use-conda --configfile .tests/integration/config/config.yaml\n</code></pre>"},{"location":"contributing/#license","title":"License","text":"<p>By submitting changes to this repository, you agree that your contributions will be licensed under its BSD-3 Clauses License.</p>"},{"location":"dev_guide/","title":"Guide for developers","text":""},{"location":"dev_guide/#changing-databases","title":"Changing databases","text":"<p>The easiest way to use alternative databases is to download them manually and provide them as paths in the configuarion.</p> <p>If you wish to deploy the module with other databases, you can also fork the repository and modify the post-deploy scripts for each environement (<code>&lt;ENV NAME&gt;.post.deploy.sh</code>). Simply modifying the URL vairable should be enough in most cases.</p>"},{"location":"dev_guide/#data-validation","title":"Data validation","text":"<p>Data validation is performed through Pydantic model validations.</p>"},{"location":"user_guide/","title":"Guide for users","text":""},{"location":"user_guide/#installation","title":"Installation","text":""},{"location":"user_guide/#conda","title":"Conda","text":"<p>Install conda from any distribution, i.e. miniconda. You can follow the setup guide from the Bioconda team.</p> <p>We advise installing the mamaba solver in the base environement to speed up environments creation.</p> <pre><code>conda install mamba -n base -c conda-forge\n</code></pre>"},{"location":"user_guide/#run-environment","title":"Run environment","text":"<p>The running environement simply required a recent python version (&gt;= 3.9) and snakemake. If you followed the steps above just run:</p> <pre><code>mamba create -n snakemake snakemake\n</code></pre>"},{"location":"user_guide/#install-module-and-databases","title":"Install module and databases","text":"<p>Download the latest realease and unpack it.</p> <p>If you're feeling brave, clone the repository form Github:</p> <pre><code>git clone https://github.com/NRW-GEUBT/geuebt-validate\n</code></pre> <p>All software and databases dependencies will be installed during the first run. It may take a little time so be patient!</p>"},{"location":"user_guide/#manually-install-databases","title":"Manually install databases","text":"<p>If for any reason you want to manually install database it is possible to provide a custom path in the configuration.</p> <p>Following databases are required:</p>"},{"location":"user_guide/#kraken2","title":"Kraken2","text":"<p>Preformatted kraken2 databases are available from: https://benlangmead.github.io/aws-indexes/k2</p> <p>The workflow uses the Standard-8 (2023-03-14) as default.</p>"},{"location":"user_guide/#busco","title":"Busco","text":"<p>The workflow uses the bacteria_odb10 for BUSCO. If you wish to install an alternatve database, see the user's guide.</p>"},{"location":"user_guide/#taxonomy","title":"Taxonomy","text":"<p>TaxidTools relies on the local availability of the Taxdump files which can be obtained from teh NCBI servers.</p> <p>Using other taxonomy definitions is not supported.</p>"},{"location":"user_guide/#configuration","title":"Configuration","text":"<p>The configuaration can be defined in two ways:</p> <ul> <li> <p>either edit and locally save the <code>config/config.yaml</code> files and provide its path   to the snakemake command with the <code>--configfile</code> argument</p> </li> <li> <p>or provide the parameters directly to the snakemake command with   <code>--config &lt;ARGNAME&gt;=&lt;VALUE&gt;</code></p> </li> </ul>"},{"location":"user_guide/#user-defined-parameters","title":"User defined parameters","text":"<p>Following arguments must be provided for each run:</p> Parameter Type Description <code>workdir</code> path-like string Path to the ouptut directory <code>metadata</code> path-like string Path to the metadata file in TSV format <code>fasta_dir</code> path-like string Path to the folder containing assembly files in fasta format"},{"location":"user_guide/#optional-parameters","title":"Optional parameters","text":"<p>Following parameters are optional and will revert to defaults if not set:</p> Parameter Type Default Description <code>max_threads_per_job</code> integer 1 Max number of threads assigned to a single job <code>kraken2_db</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the kraken2 database folder <code>busco_db</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the busco database folder <code>taxdump</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the taxdump database folder <code>min_contig_length</code> integer 500 Minimal contig length (in bp)to be included in the calculation of assemblystatistics"},{"location":"user_guide/#usage","title":"Usage","text":"<p>The workflow can be started with:</p> <pre><code>snakemake --use-conda --conda-prefix &lt;PATH TO CONDA ENVS&gt; --configfile &lt;PATH TO CONFIG&gt; --cores &lt;N&gt;\n</code></pre> <p>See the snakemake documentaiton for more information.</p>"},{"location":"user_guide/#input-formats","title":"Input formats","text":""},{"location":"user_guide/#metadata-format","title":"Metadata format","text":"<p>The metadata must be provided as a tab-delimited text data, with strict requirements:</p> Field name Definition Required? Allowed Values isolate_id Eindeutiger Bezeichner der Isolat required free text sample_id Eindeutiger Bezeichner der Probe required free text alt_isolate_id Alternativer Bezeichnung der Siolat (z.B. Laborrinternenummer) optional free text organism Erwarteter Organismus required oneof \"Listeria monocytogenes\",\"Salmonella enterica\", \"Escherichia coli\", \"Campylobacter spp.\" isolation_org Identifizierungsname des f\u00fcr die Isolation verantwortlichen Labor required oneof \"OWL\", \"RRW\", \"WFL\", \"RLD\",\"MEL\", \"other\" sequencing_org Identifizierungsname des f\u00fcr die Sequenzierung verantwortlichen Labor required oneof \"OWL\", \"RRW\", \"WFL\", \"RLD\",\"MEL\", \"other\" bioinformatics_org Identifizierungsname des f\u00fcr die Prim\u00e4r Analyse verantwortlichen Labor required oneof \"OWL\", \"RRW\", \"WFL\", \"RLD\",\"MEL\", \"other\" third_party_owner Ggfs. Name der Dritteigent\u00fcmer (z.B. bei Humanem Isolaten oder RV) optional free text extraction_method Name des Kits oder Methode f\u00fcr die DNA Extraktion optional free text library_kit Name des Kits f\u00fcr die DNA-Library Erstellung optional free text sequencing_kit Name des Kits f\u00fcr die DNA Sequenzierung optional free text sequencing_instrument Model des Ger\u00e4t f\u00fcr die DNA Sequenzierung optional free text assembly_method Name und Version des verwendeten Software oder Pipeline f\u00fcr die Assembly optional free text sample_type Art der Probe (z.B. Lebensmittel, Umfeldprobe, veterin\u00e4rmedizinisches Material, usw.) required oneof \"Lebensmittel\", \"Futtermittel\", \"Umfeld\", \"Tiergesundheit\", \"Human\", \"unknown\" fasta_name Eindeutiger Bezeichner der Sequenzdaten (Dateiname) required free text fasta_md5 MD5 Checksum der Sequenzdaten required MD5 collection_date Datum der Probenahme required ISOdate customer Einsendende KOB required Kodierung (2-5 buchstaben) manufacturer Hersteller der Probe required Freitext OR\u00a0 \"unknown\" collection_place Entnahmeort der Probe required AVV / ADV Text collection_place_code Entnahmeort der Probe required AVV / ADV Code description Bezeichnung laut Probeentnahmeschein bzw. bei Tupfern Bezeichnung der Entnahmeortes und ggfs. Tierart required free text manufacturer_type Einordnung des Entnahmeortes nach AVV-Katalog optional AVV Text manufacturer_type_code Einordnung des Entnahmeortes nach AVV-Katalog optional AVV Code matrix Einordnung der Probenmatrix nach AVV-Katalog optional AVV/TSN Text matrix_code Einordnung der Probenmatrix nach AVV-Katalog optional AVV/TSN Code collection_cause Grund f\u00fcr die Probenahme nach AVV-Katalog optional AVV Text oder Freitext collection_cause_code Grund f\u00fcr die Probenahme nach AVV-Katalog optional AVV Code lot_number Los-Nr./Chargen-Nr. des Herstellers optional free text seq_depth Durchschnittliche Sequenzierungstiefe nach Assembly required integer ref_coverage Antei Abdeckung des Referenzgenoms required float [0-1] q30 Anteil der Basen mit PHRED-Score mind. 30 required float [0-1] <p>See an example of metadata table in the <code>config</code> folder.</p>"},{"location":"user_guide/#sequence-files","title":"Sequence files","text":"<p>The assemblies must be provided as fasta file. Wrapped and unwrapped fastas as well as multifastas are allowed. There are no special requirements for sequence headers.</p>"},{"location":"user_guide/#assembly-qc-testing","title":"Assembly QC testing","text":"<p>Assemblies are tested to ensure the quality of input data. Acceptance criteria are defined by expected species as follows:</p> Parameter Listeria monocytogenes Salmonella enterica Capylobacter spp. Escherichia coli Sequencing depth 20 - 200 30 - 200 20 - 200 40 - 200 Q30 &gt;= 0.80 &gt;= 0.80 &gt;= 0.80 &gt;= 0.80 Number of contigs &gt; 1 kb 300 300 300 500 Assembly size (bp) 2,700,000 - 3,200,000 4,300,000 - 5,200,000 1,500,000 - 1,900,000 4,500,000 - 5,900,000 %GC 33.9 - 41.9 48.1 - 56.1 26.4 - 35.3 46.6 - 54.6 Orthologs found (%) &gt;=95 % &gt;=95 % &gt;=80% &gt;=95 % Duplicated orthologs (%) &lt;= 5 % &lt;= 5 % &lt;= 5 % &lt;= 5 % Fraction majority Genus &gt;= 0.95 &gt;= 0.95 &gt;= 0.90 &gt;= 0.90 Majority genus Listeria Salmonella Campylobacter Escherichia or Shigella"},{"location":"user_guide/#results","title":"Results","text":"<p>Results to be used for the next steps are located in the <code>staging</code> folder in the workdir.</p>"},{"location":"user_guide/#status-report","title":"Status report","text":"<p>A JSON report of the QC checks in the form</p> <pre><code>{\n    \"2022-0232977-01\": {\n        \"STATUS\": \"PASS\",\n        \"MESSAGES\": []\n    },\n    \"2022-0232977-02\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\n            \"Message checksum\",\n            \"Error message assembly\"\n        ]\n    },\n    \"2022-0232977-03\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\"Error message checksum\"]\n    },\n    \"2022-0232977-04\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\n            \"Error message metadata 1\",\n            \"Error message metadata 2\"\n        ]\n    }\n}\n</code></pre>"},{"location":"user_guide/#isolate-datasheets","title":"Isolate datasheets","text":"<p>Isolate information are summarized in single JSON files as well as in a merged JSON. Note that these are generated only for samples satisfying all filters. The follow the same structure, here for a single entry:</p> <pre><code>{\n    \"isolate_id\": \"2022-0232977-01\",\n    \"sample_id\": \"2022-0232977\",\n    \"organism\": \"Salmonella enterica\",\n    \"isolate_name_alt\": null,\n    \"third_party_flag\": \"true\",\n    \"third_party_owner\": \"BfR\",\n    \"sample_type\": \"unknown\",\n    \"fasta_name\": \"0232977-01.fasta\",\n    \"fasta_md5\": \"b9621a5adb8e59cbea8034bfc04fca44\",\n    \"isolation\": {\n        \"org_name\": \"unknown\"\n    },\n    \"sequencing\": {\n        \"org_name\": \"RRW\",\n        \"extraction_method\": null,\n        \"library_method\": null,\n        \"sequencing_instrument\": null\n    },\n    \"bioinformatics\": {\n        \"org_name\": \"RRW\",\n        \"assembly_method\": null\n    },\n    \"epidata\": {\n        \"collection_date\": \"2023-03-28\",\n        \"municipality\": \"unknown\",\n        \"country\": \"DE\",\n        \"cause\": \"Proficiency Test\",\n        \"collected_by\": \"unknown\",\n        \"manufacturer\": null,\n        \"designation\": \"unknown\",\n        \"manufacturer_type\": \"unknown\",\n        \"sample_description\": \"unkown\",\n        \"lot_number\": null\n    },\n    \"mlst\": {\n        \"sequence_type\": \"34\",\n        \"scheme\": \"senterica_achtman_2\",\n        \"alleles\": {\n            \"purE\": \"5\",\n            \"hemD\": \"12\",\n            \"thrA\": \"2\",\n            \"sucA\": \"9\",\n            \"hisD\": \"9\",\n            \"dnaN\": \"19\",\n            \"aroC\": \"10\"\n        }\n    },\n    \"qc_metrics\": {\n        \"sequencing_depth\": 45.6,\n        \"ref_coverage\": 0.99,\n        \"q30\": 0.9,\n        \"N50\": 284333,\n        \"L50\": 5,\n        \"n_contigs_1kbp\": 53,\n        \"assembly_size\": 4960041,\n        \"GC_perc\": 52.13,\n        \"orthologs_found\": 98.4,\n        \"duplicated_orthologs\": 0.0,\n        \"majority_genus\": \"Salmonella\",\n        \"fraction_majority_genus\": 0.9971668689656122,\n        \"majority_species\": \"Salmonella enterica\",\n        \"fraction_majority_species\": 0.9971575751364787\n    }\n}\n</code></pre>"},{"location":"user_guide/#assemblies","title":"Assemblies","text":"<p>Assemblies are renamed so that the fastas are in the form <code>&lt;ISOLATE ID&gt;.fa</code> and copied to the <code>staging/fastas/</code>folder of the workdir.</p>"},{"location":"about/changelog/","title":"Release notes","text":""},{"location":"about/changelog/#027","title":"0.2.7","text":"<p>Allows to bypass Modelchoice and provide another validation model when calling validate_metata.main() directly (for internal use only)</p>"},{"location":"about/changelog/#026","title":"0.2.6","text":"<p>Add support for 25.11.2024 date format form excel Relaxed the fraction_majority_genus cutoff to 0.9 for all species to accomodate isolate with many plasmids</p>"},{"location":"about/changelog/#025","title":"0.2.5","text":"<p>Fix missing entries in isolate sheet</p>"},{"location":"about/changelog/#024","title":"0.2.4","text":"<p>Fix isoalte sheet creation with new metadata definition</p>"},{"location":"about/changelog/#023","title":"0.2.3","text":"<p>Quickfix asssembly qc merging</p>"},{"location":"about/changelog/#022","title":"0.2.2","text":"<p>Quickfix invalid field type seq_depth from int to float</p>"},{"location":"about/changelog/#021","title":"0.2.1","text":"<p>Remove deprecated param</p>"},{"location":"about/changelog/#020","title":"0.2.0","text":"<ul> <li>Implements GE\u00dcBT Metadata v2 (03-2024)</li> <li>Changed input validation from a JSON Schema to a more flexible Pydantic Model.</li> </ul>"},{"location":"about/changelog/#017","title":"0.1.7","text":"<p>Removedhard QC threshold oncontigs &gt; 1kb and GC percent. This are optionnal parameters in the ASU and should be checked in the assembly.</p>"},{"location":"about/changelog/#016","title":"0.1.6","text":"<p>Remove unnescessary <code>isolate_id</code> field check in assembly QC</p>"},{"location":"about/changelog/#015","title":"0.1.5","text":"<p>Relaxed regex for sample naming, subsample number now accepts tow to many digits (eg. 2023-0001254-01 or 2023-0001254-5236)</p>"},{"location":"about/changelog/#014","title":"0.1.4","text":"<p>Added 'ringtrial' sample type</p>"},{"location":"about/changelog/#013","title":"0.1.3","text":"<p>Hotfix for fasta name in the isolate_sheets. Fastas are intrnally renamed to match the <code>isolate_id</code> field in order to ensure unique naming in the filesystem. This is now correctlyrefelcted in the isolate sheets.</p>"},{"location":"about/changelog/#012","title":"0.1.2","text":"<p>Checking config file with schema</p>"},{"location":"about/changelog/#011","title":"0.1.1","text":"<p>Adding unit tests</p>"},{"location":"about/changelog/#010","title":"0.1.0","text":"<p>Workflow is working. So far only JSON outputs and no documentation.</p>"},{"location":"about/license/","title":"License","text":"<p>Copyright 2023, G. Denay.</p> <p>Redistribution and use in source and binary forms, with or without  modification, are permitted provided that the following conditions are met:</p> <ol> <li> <p>Redistributions of source code must retain the above copyright notice, this  list of conditions and the following disclaimer.</p> </li> <li> <p>Redistributions in binary form must reproduce the above copyright notice,  this list of conditions and the following disclaimer in the documentation  and/or other materials provided with the distribution.</p> </li> <li> <p>Neither the name of the copyright holder nor the names of its contributors  may be used to endorse or promote products derived from this software without  specific prior written permission.</p> </li> </ol> <p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>"}]}